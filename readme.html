<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Markdown README Generator</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" rel="stylesheet" />
  <style>
    body {
      background: #fff;
      color: #01395A;
      font-family: "Times New Roman", Times, serif;
      line-height: 1.6;
      padding: 20px;
    }
    h1, h2 { color: #16A089; }
    .container { max-width: 800px; margin: 0 auto; }
    /* Initial Screen Styles */
    #initial-screen {
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      margin: 50px auto;
      border: 2px dashed #ccc;
      border-radius: 8px;
      padding: 40px;
      background: #f8f9fa;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    #initial-screen:hover {
      border-color: #0d6efd;
      background: #f0f7ff;
    }
    #docContainer { display: none; margin-top: 30px; }
    pre {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 15px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    #copyButton { margin-bottom: 15px; }
    /* Section Selection Table */
    #readmeSectionsTable {
      margin-top: 20px;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Initial Screen -->
    <div id="initial-screen" onclick="document.getElementById('jsonFileInput').click()">
      <img src="https://appwrap.com/wp-content/uploads/2024/12/appwrap-logo.svg" alt="AppWrap Logo" class="img-fluid">
      <h1 class="mb-4">Markdown README Generator</h1>
      <p class="h5 mb-3">Click or drag and drop to load your deployment manifest (JSON file)</p>
      <p class="text-muted mb-3">Select a JSON file to generate the Markdown README</p>
      <input type="file" class="d-none" id="jsonFileInput" accept="application/json" />
      <button class="btn btn-primary mb-4">Select File</button>
      <!-- Section Selection Table -->
      <table class="table table-bordered" id="readmeSectionsTable">
        <thead>
          <tr>
            <th style="width:20%;">Include</th>
            <th>Section</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><input type="checkbox" id="readme_checklist" checked /></td>
            <td>Checklist</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_toc" checked /></td>
            <td>Table of Contents</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_overview" checked /></td>
            <td>Project Overview</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_userStoriesFeatures" checked /></td>
            <td>User Stories and Features</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_dependencies" checked /></td>
            <td>Dependencies</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_installation" checked /></td>
            <td>Installation</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_fileStructure" checked /></td>
            <td>File Structure</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_scriptDetails" checked /></td>
            <td>Script Details</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_configuration" checked /></td>
            <td>Configuration</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_customRecords" checked /></td>
            <td>Custom Records</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_usage" checked /></td>
            <td>Usage</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_workflows" checked /></td>
            <td>Workflows</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_savedSearches" checked /></td>
            <td>Saved Searches</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_troubleshooting" checked /></td>
            <td>Troubleshooting</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_contactAndLicense" checked /></td>
            <td>Contact and License</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_deploymentChecklist" checked /></td>
            <td>Deployment Checklist</td>
          </tr>
          <tr>
            <td><input type="checkbox" id="readme_components" checked /></td>
            <td>Components</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Document Container -->
    <div id="docContainer">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Generated Markdown README</h2>
        <button id="copyButton" class="btn btn-secondary">
          <i class="fas fa-copy"></i> Copy All
        </button>
      </div>
      <pre><code id="docCode"></code></pre>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
/**
 * Enhanced README Generator Script
 * Author: Chino Dela Cruz
 * Date: 2025-02-28
 * Version: 1.0.0
 *
 * AppWrap Code Disclaimer:
 * Copyright 2025 AppWrap, Inc. All Rights Reserved.
 * This code is proprietary and confidential to AppWrap, Inc.
 * Unauthorized use, copying, modification, or distribution is strictly prohibited.
 */

// Grab the drop zone element so we can attach drag events:
const dropZone = document.getElementById("initial-screen");

// Main function to generate complete markdown document
function generateMarkdownDocument(data) {
  const selections = getSectionSelections();
  const step1 = data["step-1"] || {};
  const step2 = data["step-2"] || {};
  const step3 = data["step-3"] || {};
  const step4 = data["step-4"] || {};
  const step5 = data["step-5"] || {};
  const step6 = data["step-6"] || {};
  const step7 = data["step-7"] || {};
  const step8 = data["step-8"] || {};
  const step9 = data["step-9"] || {};
  const step10 = data["step-10"] || {};
  const step11 = data["step-11"] || {};
  const step12 = data["step-12"] || {};
  const step13 = data["step-13"] || {};

  let md = "";

  // Title and header
  md += `# ${step1.project_name || "Deployment Document"}\n\n`;

  // Badge section
  md += generateBadges(step1, step11) + "\n\n";

  // Checklist section
  if (selections.checklist) {
    md += generateChecklist() + "\n\n";
  }

  // Table of contents
  if (selections.toc) {
    md += generateTableOfContents(data, selections) + "\n\n";
  }

  // Project overview
  if (selections.overview) {
    md += generateProjectOverview(step1) + "\n\n";
  }

  // User stories and features
  if (selections.userStoriesFeatures) {
    md += generateUserStoriesAndFeaturesSection(step2) + "\n\n";
  }

  // Dependencies section
  if (selections.dependencies) {
    md += generateDependenciesSection(step5) + "\n\n";
  }

  // Installation section
  if (selections.installation) {
    md += generateInstallationSection(step3, step4) + "\n\n";
  }

  // File structure section
  if (selections.fileStructure) {
    md += generateFileStructureSection(step6) + "\n\n";
  }

  // Script details section
  if (selections.scriptDetails) {
    md += generateScriptDetailsSection(step6) + "\n\n";
  }

  // Configuration section
  if (selections.configuration) {
    md += generateConfigurationSection(step4, step7) + "\n\n";
  }

  // Custom records section
  if (selections.customRecords) {
    md += generateCustomRecordsSection(step7) + "\n\n";
  }

  // Usage section
  if (selections.usage) {
    md += generateUsageSection(step2) + "\n\n";
  }

  // Workflows section
  if (selections.workflows) {
    md += generateWorkflowsSection(step8) + "\n\n";
  }

  // Custom fields section
  if (selections.customFields) {
    md += generateCustomFieldsSection(step9) + "\n\n";
  }

  // Saved searches section
  if (selections.savedSearches) {
    md += generateSavedSearchesSection(step9) + "\n\n";
  }

  // Templates section
  if (selections.templates) {
    md += generateTemplatesSection(step9) + "\n\n";
  }

  // Troubleshooting section
  if (selections.troubleshooting) {
    md += generateTroubleshootingSection(step10) + "\n\n";
  }

  // Deployment checklist section
  if (selections.deploymentChecklist) {
    md += generateDeploymentChecklistSection(step11) + "\n\n";
  }

  // Components section
  if (selections.components) {
    md += generateComponentsSection(step13) + "\n\n";
  }

  // Contact and license section
  if (selections.contactAndLicense) {
    md += generateContactAndLicenseSection(step12);
  }

  return md;
}

// Generate status badges for the README
function generateBadges(step1, step11) {
  const version = step1.version ? step1.version.replace(/^v/, '') : '0.0.0';
  const deploymentStatus = step11 && step11.deployment_plan_approved ? 'Approved' : 'Pending';
  const deploymentColor = deploymentStatus === 'Approved' ? 'brightgreen' : 'yellow';

  return `![Version](https://img.shields.io/badge/Version-${version}-blue)
![Environment](https://img.shields.io/badge/Environment-${step1.development_environment || 'Development'}-orange)
![Deployment](https://img.shields.io/badge/Deployment-${deploymentStatus}-${deploymentColor})
![Updated](https://img.shields.io/badge/Updated-${step1.date || getCurrentDateString()}-informational)`;
}

// Generate the checklist section with AppWrap disclaimers
function generateChecklist() {
  return `## Checklist

- [ ] Project upholds [AppWrap's Deployment Standards and Best Practices](https://drive.google.com/file/d/1bYRw2rDC2-eFiLa3FVQVpDciEolIRBbs/view?usp=drive_link)
- [ ] Scripts include [AppWrap's Code Disclaimer and Header](https://placeholder-link.com)
- [ ] Contributors adhere to [AppWrap's Developer and Technical Resources Expectations](https://docs.google.com/document/d/1fEv4BEYmUTOiqKibxuMdngFqAKNljBnC4XhAMHbnwZA/edit)`;
}

// Generate dynamic table of contents based on selected sections
function generateTableOfContents(data, selections) {
  let toc = "## Table of Contents\n\n";

  if (selections.overview) {
    toc += "- [Project Overview](#project-overview)\n";
  }

  if (selections.userStoriesFeatures) {
    toc += "- [User Stories and Features](#user-stories-and-features)\n";
  }

  if (selections.dependencies) {
    toc += "- [Dependencies](#dependencies)\n";
    toc += "  - [Deployment Dependencies](#deployment-dependencies)\n";
    toc += "  - [Dev Dependencies](#dev-dependencies)\n";
  }

  if (selections.installation) {
    toc += "- [Installation](#installation)\n";
  }

  if (selections.fileStructure) {
    toc += "- [File Structure](#file-structure)\n";
    if (data["step-6"] && data["step-6"].scripts && data["step-6"].scripts.length > 0) {
      toc += "  - [Primary Scripts](#primary-scripts)\n";

      // Get unique libraries across all scripts
      let libraries = [];
      data["step-6"].scripts.forEach(script => {
        if (script.libraries && script.libraries.length > 0) {
          script.libraries.forEach(lib => {
            if (!libraries.some(l => l.library_name === lib.library_name)) {
              libraries.push(lib);
            }
          });
        }
      });

      if (libraries.length > 0) {
        toc += "  - [Library Scripts](#library-scripts)\n";
      }
    }
  }

  if (selections.scriptDetails) {
    toc += "- [Script Details](#script-details)\n";
    if (data["step-6"] && data["step-6"].scripts && data["step-6"].scripts.length > 0) {
      data["step-6"].scripts.forEach(script => {
        let scriptName = script.name || "Unnamed Script";
        toc += `    - [${scriptName}](#${slugify(scriptName)})\n`;
      });
    }
  }

  if (selections.configuration) {
    toc += "- [Configuration](#configuration)\n";
  }

  if (selections.customRecords) {
    toc += "- [Custom Records](#custom-records)\n";
    if (data["step-7"] && data["step-7"].customRecords && data["step-7"].customRecords.length > 0) {
      data["step-7"].customRecords.forEach(record => {
        let recordName = record.name || "Unnamed Record";
        toc += `    - [${recordName}](#${slugify(recordName)})\n`;
      });
    }
  }

  if (selections.usage) {
    toc += "- [Usage](#usage)\n";
  }

  if (selections.workflows) {
    toc += "- [Workflows](#workflows)\n";
    if (data["step-8"] && data["step-8"].workflows && data["step-8"].workflows.length > 0) {
      data["step-8"].workflows.forEach((wf, i) => {
        let wfName = wf.details || `Workflow ${i + 1}`;
        toc += `    - [${wfName}](#${slugify(wfName)})\n`;
      });
    }
  }

  if (selections.customFields) {
    toc += "- [Custom Fields](#custom-fields)\n";
  }

  if (selections.savedSearches) {
    toc += "- [Saved Searches](#saved-searches)\n";
  }

  if (selections.templates) {
    toc += "- [Templates](#templates)\n";
  }

  if (selections.troubleshooting) {
    toc += "- [Troubleshooting](#troubleshooting)\n";
  }

  if (selections.deploymentChecklist) {
    toc += "- [Deployment Checklist](#deployment-checklist)\n";
  }

  if (selections.components) {
    toc += "- [Components](#components)\n";
  }

  if (selections.contactAndLicense) {
    toc += "- [Contact Information](#contact-information)\n";
    toc += "- [License](#license)\n";
  }

  return toc;
}

// Generate project overview section
function generateProjectOverview(step1) {
  let md = "## Project Overview\n\n";

  if (step1.change_summary) {
    md += step1.change_summary + "\n\n";
  }

  md += "| Project Detail | Value |\n|---------------|-------|\n";
  if (step1.client) md += `| **Client** | ${step1.client} |\n`;
  if (step1.development_environment) md += `| **Environment** | ${step1.development_environment} |\n`;
  if (step1.version) md += `| **Version** | ${step1.version} |\n`;
  if (step1.date) md += `| **Last Updated** | ${step1.date} |\n`;
  if (step1.developer) md += `| **Developer** | ${step1.developer} |\n`;
  md += "\n";

  if (step1["version-history-body"] && step1["version-history-body"].length > 0) {
    md += "<details>\n<summary>Version History</summary>\n\n";
    md += "| Version | Date | Summary |\n|---------|------|----------|\n";
    step1["version-history-body"].forEach(v => {
      md += `| ${v.version || ""} | ${v.date || ""} | ${v.change_summary || ""} |\n`;
    });
    md += "\n</details>\n\n";
  }

  return md;
}

// Generate user stories and features section
function generateUserStoriesAndFeaturesSection(step2) {
  let md = "## User Stories and Features\n\n";

  // User Stories section
  md += "### User Stories\n\n";
  if (step2["user-stories-body"] && step2["user-stories-body"].length > 0) {
    md += "| Story ID | Story Description |\n|----------|-------------------|\n";
    step2["user-stories-body"].forEach(story => {
      md += `| ${story.story_id || ""} | ${story.story_description || ""} |\n`;
    });
  } else {
    md += "No user stories specified.\n";
  }
  md += "\n";

  // Features section
  md += "### Features\n\n";
  if (step2["features-body"] && step2["features-body"].length > 0) {
    md += "| Feature Title | Feature Description |\n|---------------|---------------------|\n";
    step2["features-body"].forEach(feature => {
      md += `| ${feature.feature_title || ""} | ${feature.feature_description || ""} |\n`;
    });
  } else {
    md += "No features specified.\n";
  }
  md += "\n";

  return md;
}

// Generate dependencies section
function generateDependenciesSection(step5) {
  let md = "## Dependencies\n\n";

  // Deployment dependencies
  md += "### Deployment Dependencies\n\n";
  if (step5["deployment-dependencies-body"] && step5["deployment-dependencies-body"].length > 0) {
    md += "| Dependency | Version | License |\n|------------|---------|----------|\n";
    step5["deployment-dependencies-body"].forEach(dep => {
      md += `| ${dep.dependency_name || ""} | ${dep.dependency_version || ""} | ${dep.dependency_license || ""} |\n`;
    });
  } else {
    md += "No deployment dependencies specified.\n";
  }
  md += "\n";

  // Development dependencies
  md += "### Dev Dependencies\n\n";
  if (step5["dev-dependencies-body"] && step5["dev-dependencies-body"].length > 0) {
    md += "| Dependency | Version | License |\n|------------|---------|----------|\n";
    step5["dev-dependencies-body"].forEach(dep => {
      md += `| ${dep.dependency_name || ""} | ${dep.dependency_version || ""} | ${dep.dependency_license || ""} |\n`;
    });
  } else {
    md += "No development dependencies specified.\n";
  }

  return md;
}

// Generate installation section
function generateInstallationSection(step3, step4) {
  let md = "## Installation\n\n";

  // Environment IDs
  if (step4["environment-ids-body"] && step4["environment-ids-body"].length > 0) {
    md += "### Environment Settings\n\n";
    md += "| Environment Name | Notes | Sandbox Value | Production Value |\n|------------------|-------|---------------|------------------|\n";
    step4["environment-ids-body"].forEach(env => {
      md += `| ${env.env_name || ""} | ${env.env_notes || ""} | ${env.sandbox_value || ""} | ${env.production_value || ""} |\n`;
    });
    md += "\n";
  }

  // Installation processes
  if (step3.processes && step3.processes.length > 0) {
    md += "### Installation Steps\n\n";
    step3.processes.forEach((process, procIndex) => {
      md += `#### ${process.name || 'Process ' + (procIndex + 1)}\n\n`;
      if (process.steps && process.steps.length > 0) {
        process.steps.forEach((step, stepIndex) => {
          md += `${stepIndex + 1}. ${step.step_description || "Step description not provided"}\n`;
        });
      } else {
        md += "No steps defined for this process.\n";
      }
      md += "\n";
    });
  }

  // Rollback steps
  if (step3.rollbacks && step3.rollbacks.length > 0) {
    md += "### Rollback Steps\n\n";
    md += "> âš ï¸ Use these steps in case the deployment needs to be reverted\n\n";
    step3.rollbacks.forEach((rollback, index) => {
      md += `${index + 1}. ${rollback.description || "Rollback step not described"}\n`;
    });
  }

  return md;
}

// Generate file structure section
function generateFileStructureSection(step6) {
  let md = "## File Structure\n\n";

  // Primary scripts
  md += "### Primary Scripts\n\n";
  if (step6.scripts && step6.scripts.length > 0) {
    md += "| Script Name | Script Type | Purpose |\n|------------|-------------|----------|\n";
    step6.scripts.forEach(script => {
      const details = script.details || {};
      md += `| \`${details.fileName || ""}\` | ${details.type || ""} | ${details.description || ""} |\n`;
    });
  } else {
    md += "No scripts specified.\n";
  }
  md += "\n";

  // Library scripts
  md += "### Library Scripts\n\n";
  if (step6.scripts && step6.scripts.length > 0) {
    // Get unique libraries across all scripts
    let libraries = [];
    step6.scripts.forEach(script => {
      if (script.libraries && script.libraries.length > 0) {
        script.libraries.forEach(lib => {
          if (!libraries.some(l => l.library_name === lib.library_name)) {
            libraries.push(lib);
          }
        });
      }
    });

    if (libraries.length > 0) {
      md += "| Script Name | Purpose |\n|------------|----------|\n";
      libraries.forEach(lib => {
        md += `| \`${lib.library_name || ""}\` | ${lib.purpose || ""} |\n`;
      });
    } else {
      md += "No library scripts specified.\n";
    }
  } else {
    md += "No library scripts specified.\n";
  }

  return md;
}

// Generate script details section
function generateScriptDetailsSection(step6) {
  let md = "## Script Details\n\n";

  if (step6.scripts && step6.scripts.length > 0) {
    step6.scripts.forEach(script => {
      const details = script.details || {};

      md += `### ${script.name || "Unnamed Script"}\n\n`;
      md += `**Type:** ${details.type || "N/A"}  \n`;
      md += `**File Name:** \`${details.fileName || ""}\`  \n`;
      md += `**Description:** ${details.description || "No description provided."}\n\n`;

      // Script location
      if (details.location) {
        md += `**Location:** \`${details.location}\`\n\n`;
      }

      // Script ID
      if (details.id) {
        md += `**Script ID:** \`${details.id}\`\n\n`;
      }

      // Script parameters
      if (script.parameters && script.parameters.length > 0) {
        md += "<details>\n<summary>Script Parameters</summary>\n\n";
        md += "| Parameter Name | Parameter ID | Type | Description |\n|---------------|--------------|------|-------------|\n";
        script.parameters.forEach(param => {
          md += `| ${param.parameter_name || ""} | \`${param.parameter_id || ""}\` | ${param.parameter_type || ""} | ${param.parameter_description || ""} |\n`;
        });
        md += "\n</details>\n\n";
      }

      // Entry points
      if (script.entryPoints && script.entryPoints.length > 0) {
        md += "<details>\n<summary>Entry Points</summary>\n\n";
        md += "| Event | Function |\n|-------|----------|\n";
        script.entryPoints.forEach(ep => {
          md += `| ${ep.entry_point_name || ""} | ${ep.function_name || ""} |\n`;
        });
        md += "\n</details>\n\n";
      }

      // Deployment records
      if (script.deploymentRecords && script.deploymentRecords.length > 0) {
        md += "**Deployment Records:**\n";
        script.deploymentRecords.forEach(record => {
          md += `- **Applied To:** ${record.applied_to || ""} â€” **ID:** \`${record.deployment_id || ""}\` (${record.deployment_notes || ""})\n`;
        });
        md += "\n";
      } else {
        md += "**Deployment Records:** None\n\n";
      }

      // Unit tests
      if (script.unitTests && script.unitTests.length > 0) {
        md += "<details>\n<summary>Unit Tests</summary>\n\n";
        md += "| Test Description | Test Result |\n|-----------------|-------------|\n";
        script.unitTests.forEach(test => {
          md += `| ${test.test_description || ""} | ${test.test_result || ""} |\n`;
        });
        md += "\n</details>\n\n";
      } else {
        md += "**Unit Tests:** None\n\n";
      }

      // Checklists
      if (script.checklists) {
        md += "**Compliance:**\n";
        md += `- Standards: ${script.checklists.standards ? "âœ…" : "âŒ"}\n`;
        md += `- Disclaimer: ${script.checklists.disclaimer ? "âœ…" : "âŒ"}\n`;
        md += `- Expectations: ${script.checklists.expectations ? "âœ…" : "âŒ"}\n`;
        md += `- ESLint: ${script.checklists.eslint ? "âœ…" : "âŒ"}\n\n`;
      }

      // Libraries used
      if (script.libraries && script.libraries.length > 0) {
        md += "**Libraries:**\n";
        script.libraries.forEach(lib => {
          md += `- \`${lib.library_name || ""}\`: ${lib.purpose || ""}\n`;
        });
        md += "\n";
      }

      // Version history
      if (script.versionHistory && script.versionHistory.length > 0) {
        md += "<details>\n<summary>Version History</summary>\n\n";
        md += "| Version | Date | Change Summary | Commit ID |\n|---------|------|----------------|------------|\n";
        script.versionHistory.forEach(vh => {
          md += `| ${vh.version || ""} | ${vh.date || ""} | ${vh.change_summary || ""} | ${vh.commit_id || "N/A"} |\n`;
        });
        md += "\n</details>\n\n";
      }

      md += "---\n\n";
    });
  } else {
    md += "No scripts specified.\n\n";
  }

  return md;
}

// Generate configuration section
function generateConfigurationSection(step4, step7) {
  let md = "## Configuration\n\n";

  // Environment configurations
  if (step4["environment-ids-body"] && step4["environment-ids-body"].length > 0) {
    md += "> ðŸ”§ These settings need to be configured for each environment\n\n";
  }

  // Custom record configuration
  if (step7.customRecords && step7.customRecords.length > 0) {
    // Find configuration records
    const configRecords = step7.customRecords.filter(r =>
      r.description && r.description.toLowerCase().includes('config')
    );

    if (configRecords.length > 0) {
      configRecords.forEach(record => {
        md += `### ${record.name || "Configuration"} (\`${record.id || ""}\`)\n\n`;

        if (record.description) {
          md += record.description + "\n\n";
        }

        if (record.fields && record.fields.length > 0) {
          md += "| Field Name | Field ID | Type | Description |\n|------------|----------|------|-------------|\n";
          record.fields.forEach(field => {
            md += `| ${field.field_name || ""} | \`${field.field_id || ""}\` | ${field.field_type || ""} | ${field.field_description || ""} |\n`;
          });
          md += "\n";
        } else {
          md += "No configuration fields specified.\n\n";
        }
      });
    } else {
      md += "No configuration records specified.\n\n";
    }
  } else {
    md += "No configuration fields specified.\n\n";
  }

  return md;
}

// Generate custom records section
function generateCustomRecordsSection(step7) {
  let md = "## Custom Records\n\n";

  if (step7.customRecords && step7.customRecords.length > 0) {
    step7.customRecords.forEach(record => {
      md += `### ${record.name || "Unnamed Record"}\n\n`;

      if (record.description) {
        md += record.description + "\n\n";
      }

      md += `- **ID:** \`${record.id || ""}\`\n`;
      md += `- **Type:** \`${record.type || ""}\`\n\n`;

      if (record.fields && record.fields.length > 0) {
        md += "#### Fields\n\n";
        md += "| Field Name | Field ID | Type | Description |\n|------------|----------|------|-------------|\n";
        record.fields.forEach(field => {
          md += `| ${field.field_name || ""} | \`${field.field_id || ""}\` | ${field.field_type || ""} | ${field.field_description || ""} |\n`;
        });
        md += "\n";
      } else {
        md += "No fields defined for this record.\n\n";
      }

      md += "---\n\n";
    });
  } else {
    md += "No custom records specified.\n\n";
  }

  return md;
}

// Generate usage section
function generateUsageSection(step2) {
  let md = "## Usage\n\n";

  if (step2["usage-body"] && step2["usage-body"].length > 0) {
    step2["usage-body"].forEach((usage, index) => {
      md += `### ${usage.usage_title || 'Usage Scenario ' + (index + 1)}\n\n`;
      md += usage.usage_description + "\n\n";
    });
  } else {
    md += "No usage instructions specified.\n\n";
  }

  return md;
}

// Generate workflows section
function generateWorkflowsSection(step8) {
  let md = "## Workflows\n\n";

  if (step8.workflows && step8.workflows.length > 0) {
    step8.workflows.forEach((wf, i) => {
      md += `### ${wf.details || `Workflow ${i + 1}`}\n\n`;

      if (wf.actions && wf.actions.length > 0) {
        md += "| Action | State | Details |\n|--------|-------|----------|\n";
        wf.actions.forEach(action => {
          md += `| ${action.action || ""} | ${action.state || ""} | ${action.details || ""} |\n`;
        });
        md += "\n";
      } else {
        md += "No actions defined for this workflow.\n\n";
      }

      md += "---\n\n";
    });
  } else {
    md += "No workflows specified.\n\n";
  }

  return md;
}

// Generate custom fields section
function generateCustomFieldsSection(step9) {
  let md = "## Custom Fields\n\n";

  if (step9["custom-fields-body"] && step9["custom-fields-body"].length > 0) {
    md += "| Field Name | Field ID | Type | Description | Applies To |\n|------------|----------|------|-------------|------------|\n";
    step9["custom-fields-body"].forEach(field => {
      md += `| ${field.field_name || ""} | \`${field.field_id || ""}\` | ${field.field_type || ""} | ${field.field_description || ""} | ${field.applies_to || ""} |\n`;
    });
    md += "\n";
  } else {
    md += "No custom fields specified.\n\n";
  }

  return md;
}

// Generate saved searches section
function generateSavedSearchesSection(step9) {
  let md = "## Saved Searches\n\n";

  if (step9["saved-searches-body"] && step9["saved-searches-body"].length > 0) {
    md += "| Search Name | Search ID | Description |\n|-------------|-----------|-------------|\n";
    step9["saved-searches-body"].forEach(search => {
      md += `| ${search.search_name || ""} | \`${search.search_id || ""}\` | ${search.search_description || ""} |\n`;
    });
    md += "\n";

    // Detailed search criteria in collapsible sections
    md += "### Search Criteria Details\n\n";
    step9["saved-searches-body"].forEach(search => {
      if (search.search_criteria || search.search_results) {
        md += `<details>\n<summary>${search.search_name || "Search"} Criteria</summary>\n\n`;
        if (search.search_criteria) {
          md += "**Criteria:**\n\n" + search.search_criteria + "\n\n";
        }
        if (search.search_results) {
          md += "**Results:**\n\n" + search.search_results + "\n\n";
        }
        md += "</details>\n\n";
      }
    });
  } else {
    md += "No saved searches specified.\n\n";
  }

  return md;
}

// Generate templates section
function generateTemplatesSection(step9) {
  let md = "## Templates\n\n";

  if (step9["templates-body"] && step9["templates-body"].length > 0) {
    md += "| Template Name | Template ID | Type | Description |\n|---------------|--------------|------|-------------|\n";
    step9["templates-body"].forEach(template => {
      md += `| ${template.template_name || ""} | \`${template.template_id || ""}\` | ${template.template_type || ""} | ${template.template_description || ""} |\n`;
    });
    md += "\n";
  } else {
    md += "No templates specified.\n\n";
  }

  return md;
}

// Generate troubleshooting section
function generateTroubleshootingSection(step10) {
  let md = "## Troubleshooting\n\n";

  if (step10["troubleshooting-body"] && step10["troubleshooting-body"].length > 0) {
    md += "| Issue | Cause | Resolution |\n|-------|-------|------------|\n";
    step10["troubleshooting-body"].forEach(issue => {
      md += `| ${issue.error_issue || ""} | ${issue.cause || ""} | ${issue.resolution || ""} |\n`;
    });
    md += "\n";

    // Add prevention steps if available
    const issuesWithPrevention = step10["troubleshooting-body"].filter(i => i.prevention);
    if (issuesWithPrevention.length > 0) {
      md += "### Prevention Measures\n\n";
      issuesWithPrevention.forEach(issue => {
        md += `- **${issue.error_issue || "Issue"}**: ${issue.prevention}\n`;
      });
      md += "\n";
    }
  } else {
    md += "No troubleshooting issues specified.\n\n";
  }

  // Add unit testing results if available
  if (step10.unitTesting && step10.unitTesting.length > 0) {
    md += "### Unit Testing Results\n\n";
    md += "| Test Description | Result |\n|-------------------|--------|\n";
    step10.unitTesting.forEach(test => {
      md += `| ${test.test_description || ""} | ${test.test_result || ""} |\n`;
    });
    md += "\n";
  }

  return md;
}

// Generate deployment checklist section
function generateDeploymentChecklistSection(step11) {
  let md = "## Deployment Checklist\n\n";

  md += "> âœ… = Completed, âŒ = Not Completed\n\n";

  md += "| Checklist Item | Status |\n|---------------|--------|\n";
  md += `| Production Version Backed Up | ${step11.production_version_backed_up ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Code Changes Documented | ${step11.code_changes_documented ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Fields/Records Listed | ${step11.fields_records_listed ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Rollback Steps Defined | ${step11.rollback_steps_defined ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Deployment Reviewed | ${step11.deployment_reviewed ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Tested by Functional | ${step11.tested_by_functional ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Tested by Client | ${step11.tested_by_client ? 'âœ…' : 'âŒ'} |\n`;
  md += `| Deployment Plan Approved | ${step11.deployment_plan_approved ? 'âœ…' : 'âŒ'} |\n`;

  return md;
}

// Generate components section
function generateComponentsSection(step13) {
  let md = "## Components\n\n";

  if (step13["components-body"] && step13["components-body"].length > 0) {
    md += "| Component Type | Component Name | Status | Installation Method |\n|----------------|----------------|--------|---------------------|\n";
    step13["components-body"].forEach(comp => {
      md += `| ${comp.component_type || ""} | ${comp.component_name || ""} | ${comp.status || ""} | ${comp.installation_method || ""} |\n`;
    });
    md += "\n";

    // Detailed component information
    md += "### Component Details\n\n";

    // Group components by type
    const componentTypes = [...new Set(step13["components-body"].map(c => c.component_type))];

    componentTypes.forEach(type => {
      md += `#### ${type} Components\n\n`;
      const typeComponents = step13["components-body"].filter(c => c.component_type === type);

      typeComponents.forEach(comp => {
        md += `- **${comp.component_name || "Unnamed Component"}**\n`;
        md += `  - Deployment Date: ${comp.deployment_date || "TBD"}\n`;
        md += `  - Documentation Version: ${comp.documentation_version || "v1"}\n`;
        if (comp.change_description && comp.change_description !== "None") {
          md += `  - Change Description: ${comp.change_description}\n`;
        }
        md += "\n";
      });
    });
  } else {
    md += "No components specified.\n\n";
  }

  return md;
}

// Generate contact and license section
function generateContactAndLicenseSection(step12) {
  let md = "## Contact Information\n\n";

  // Developers contact information
  if (step12["developers-body"] && step12["developers-body"].length > 0) {
    md += "| Developer Name | Email | Note |\n|----------------|-------|------|\n";
    step12["developers-body"].forEach(dev => {
      md += `| ${dev.developer_name || ""} | ${dev.developer_email || ""} | ${dev.developer_note || ""} |\n`;
    });
    md += "\n";
  } else {
    md += "No developer information specified.\n\n";
  }

  // Functional contacts information
  if (step12["functional-body"] && step12["functional-body"].length > 0) {
    md += "| Functional Name | Email | Note |\n|-----------------|-------|------|\n";
    step12["functional-body"].forEach(func => {
      md += `| ${func.functional_name || ""} | ${func.functional_email || ""} | ${func.functional_note || ""} |\n`;
    });
    md += "\n";
  } else {
    md += "No functional contact information specified.\n\n";
  }

  // License information
  md += "## License\n\n";
  if (step12.license) {
    md += "```\n" + step12.license.trim() + "\n```\n";
  } else {
    md += "No license information provided.\n";
  }

  return md;
}

// Helper function to get current date in YYYY-MM-DD format
function getCurrentDateString() {
  const now = new Date();
  const year = now.getFullYear();
  const month = String(now.getMonth() + 1).padStart(2, '0');
  const day = String(now.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

// Helper function to slugify text for anchor links
function slugify(text) {
  return text.toLowerCase()
    .replace(/[^\w ]+/g, '')
    .replace(/ +/g, '-');
}

// Get section selections from UI checkboxes
// Get section selections from UI checkboxes
function getSectionSelections() {
  return {
    checklist: document.getElementById('readme_checklist')?.checked ?? true,
    toc: document.getElementById('readme_toc')?.checked ?? true,
    overview: document.getElementById('readme_overview')?.checked ?? true,
    userStoriesFeatures: document.getElementById('readme_userStoriesFeatures')?.checked ?? true,
    dependencies: document.getElementById('readme_dependencies')?.checked ?? true,
    installation: document.getElementById('readme_installation')?.checked ?? true,
    fileStructure: document.getElementById('readme_fileStructure')?.checked ?? true,
    scriptDetails: document.getElementById('readme_scriptDetails')?.checked ?? true,
    configuration: document.getElementById('readme_configuration')?.checked ?? true,
    customRecords: document.getElementById('readme_customRecords')?.checked ?? true,
    usage: document.getElementById('readme_usage')?.checked ?? true,
    workflows: document.getElementById('readme_workflows')?.checked ?? true,
    customFields: document.getElementById('readme_customFields')?.checked ?? true,
    savedSearches: document.getElementById('readme_savedSearches')?.checked ?? true,
    templates: document.getElementById('readme_templates')?.checked ?? true,
    troubleshooting: document.getElementById('readme_troubleshooting')?.checked ?? true,
    deploymentChecklist: document.getElementById('readme_deploymentChecklist')?.checked ?? true,
    components: document.getElementById('readme_components')?.checked ?? true,
    contactAndLicense: document.getElementById('readme_contactAndLicense')?.checked ?? true
  };
}
// Prevent default drag behaviors
["dragenter", "dragover", "dragleave", "drop"].forEach(eventName => {
  dropZone.addEventListener(eventName, preventDefaults, false);
  document.body.addEventListener(eventName, preventDefaults, false);
});

function preventDefaults(e) {
  e.preventDefault();
  e.stopPropagation();
}

// Highlight drop zone on drag events
["dragenter", "dragover"].forEach(eventName => {
  dropZone.addEventListener(eventName, highlight, false);
});
["dragleave", "drop"].forEach(eventName => {
  dropZone.addEventListener(eventName, unhighlight, false);
});

function highlight() {
  dropZone.classList.add("border-primary", "bg-light");
}
function unhighlight() {
  dropZone.classList.remove("border-primary", "bg-light");
}

// Handle file drop
dropZone.addEventListener("drop", handleDrop, false);
function handleDrop(e) {
  const dt = e.dataTransfer;
  const file = dt.files[0];
  if (file) handleFile(file);
}

// Handle file selection
document.getElementById("jsonFileInput").addEventListener("change", function(e) {
  const file = e.target.files[0];
  if (file) handleFile(file);
});

// Copy button functionality
document.getElementById("copyButton").addEventListener("click", function() {
  navigator.clipboard.writeText(document.getElementById('docCode').textContent)
    .then(() => {
      this.innerHTML = '<i class="fas fa-check"></i> Copied!';
      setTimeout(() => {
        this.innerHTML = '<i class="fas fa-copy"></i> Copy All';
      }, 2000);
    })
    .catch(err => console.error("Error copying text:", err));
});

// Handle file selection and display generated README
function handleFile(file) {
  const reader = new FileReader();
  reader.onload = function(event) {
    try {
      // Clean any potential BOM characters from the JSON:
      const fileContent = event.target.result.replace(/^\uFEFF/, "");
      const data = JSON.parse(fileContent);
      displayDocument(data);
      document.getElementById('initial-screen').style.display = "none";
      document.getElementById('docContainer').style.display = "block";
    } catch (err) {
      console.error("Error parsing JSON:", err);
      alert("Error parsing JSON file. Please check the file format and try again.");
    }
  };
  reader.onerror = function() {
    console.error("File reading error");
    alert("Error reading file. Please try again.");
  };
  reader.readAsText(file);
}

// Display the generated markdown
function displayDocument(data) {
  try {
    const markdown = generateMarkdownDocument(data);
    document.getElementById('docCode').textContent = markdown;
  } catch (e) {
    console.error("Error generating document:", e);
    alert("An error occurred while generating the document. Please check the console for details.");
  }
}
  </script>
</body>
</html>
